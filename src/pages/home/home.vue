/**
 * Created by zhangxin on 2018/11/18.
 */
<template>
  <el-container class="home" v-loading="loading">
    <el-header>
      <!--<el-dropdown class="nav-bar-right">
        <div class="head-img-box">
          <span class="circle-bg">
            <img src="../../assets/headimg.png" alt="head-img">
          </span>
          <span>{{userName}}</span>
          <i class="el-icon-caret-bottom"></i>
        </div>
        <el-dropdown-menu slot="dropdown">
          <el-dropdown-item>十大大 ： 苏打飒飒大苏打萨达萨达撒旦</el-dropdown-item>
          <el-dropdown-item>{{userType}}</el-dropdown-item>
          <el-dropdown-item>
            <div @click="logout" style="display: inline-block;width: 100%;height: 100%">退出</div>
          </el-dropdown-item>
        </el-dropdown-menu>
      </el-dropdown>-->
      <el-popover
        class="nav-bar-right"
        placement="bottom"
        width="300"
        trigger="click">
        <div class="downBox">
          <div class="downBoxImg">
            <span class="circleImage">
              <img src="../../assets/headimg.png" alt="head-img">
            </span>
           <p class="userText">{{userType}}</p>
          </div>
          <p class="userLab">
            <span class="mr-20">
              用户电话：
            </span>
            {{userPhone}}
          </p>
          <p class="userLab">
            <span class="mr-20">
              用户邮箱：
            </span>
            {{userEmail}}
          </p>
          <p class="userLab">
            <span class="mr-20">
              所属公司：
            </span>
            {{companyName}}
          </p>
          <p class="userLab">
            <span class="mr-20">
              所属部门：
            </span>
            {{departmentName}}
          </p>
          <el-button type="primary">修改密码</el-button>
          <el-button type="primary" @click="logout">退出登陆</el-button>
        </div>
        <div class="head-img-box" slot="reference">
          <span class="circle-bg">
            <img src="../../assets/headimg.png" alt="head-img">
          </span>
          <span style="cursor: pointer">{{userName}}</span>
          <i class="el-icon-caret-bottom"></i>
        </div>
      </el-popover>
    </el-header>
    <el-main>
      <ul class="menu">
        <li>
          <!--:to="{path:'/LayoutNoLeft', query:{flag:'公示信息'}}"-->
          <div  @click="frameLink('LayoutNoLeft')" class="menu-item">
            <img src="@/assets/monitor.png" alt="">
          </div>
          <p>公示信息</p>
        </li>
        <li>
          <div @click="frameLink('LayoutNoLeft/attention')" class="menu-item">
            <img src="@/assets/rss.png" alt="">
          </div>
          <p>关注信息</p>
        </li>
        <li>
          <div @click="frameData" class="menu-item">
            <img src="@/assets/custom_reports.png" alt="">
          </div>
          <p>数据管理</p>
        </li>
        <li>
          <div @click="frameLink('historyData')" class="menu-item">
            <img src="@/assets/bar_chart.png" alt="">
          </div>
          <p>数据统计</p>
        </li>
        <li>
          <div @click="frameLink('management')" class="menu-item">
            <img src="@/assets/file_cabinet.png" alt="">
          </div>
          <p>公示管理</p>
        </li>
        <li>
          <div @click="frameLink('company')"  class="menu-item">
            <img src="@/assets/document_console.png" alt="">
          </div>
          <p>权限管理</p>
        </li>
      </ul>
    </el-main>
    <div class="frameBox" v-show="frameShow" id="frameBox">
        <div class="frameTit">
          <div class="iBox clearFix">
            <i class="iconfont icon-cross pull-right titBtn ml-10" @click="closeFrame"></i>
            <i class="iconfont icon--quanbubiankuang pull-right titBtn ml-10" @click="bigFrame"></i>
            <i class="iconfont icon-jianhao pull-right titBtn ml-10" @click="smallFrame"></i>
          </div>
        </div>
        <iframe src="/LayoutNoLeft" class="frame" id="frame" frameborder="0"></iframe>
      </div>
  </el-container>
</template>
<script>
/**
 * import '../../assets/vendor/iCkeck-v1.0.2/js/icheck.min';
 * import "vue-style-loader!css-loader!sass-loader!../../assets/vendor/iCkeck-v1.0.2/css/skins/square/blue.css";
 * import loginButton from './components/loginButton.vue';
 */
export default{
  data () {
    return {
      msg: '首页',
      rouPath:'',
      frameShow:false,
      frameDom:'',
      frame:'',
      loading:false,
      userName:'',
      userType:'',
      userPhone:'',
      userEmail:'',
      departmentName:'',
      companyName:'',
      wrapper:''
    }
  },
  components: {},
  methods: {
    removeKey () {
      sessionStorage.removeItem('key')
    },
    frameLink(urlPath){
      let vm = this
      this.loading = true
      this.wrapper = 'wrapper'
      let name = ''
      if(urlPath == 'LayoutNoLeft'){
        name = '公示信息'
      }else if(urlPath == 'LayoutNoLeft/attention'){
        name = '关注信息'
      }else if(urlPath == 'historyData'){
        name = '历史数据'
      }else if(urlPath == 'management'){
        name = '公示管理'
      }else if(urlPath == 'company'){
        name = '公司管理'
      }
      this.frame.src= urlPath
      window.sessionStorage.setItem('publicName', name)
      /*this.$store.dispatch('PUBLIC_HEADER_TYPE', { name })*/
      this.frameShow = true
      setTimeout(function () {
        vm.loading = false
      },1000)
    },
    frameData(){
      let vm = this
      this.loading = true
      let data = {
        accountToken:  sessionStorage.getItem('accessToken'),
        accountId: sessionStorage.getItem('accountId')
      }
      this.frame.src= 'http://10.220.1.6:31246'
      /**测试地址
       * http://daas-website.tpaas.youedata.com
       */
      /**线上地址
       * http://10.220.1.6:31246
       */
      setTimeout(function () {
        window.frames[0].postMessage(data, 'http://10.220.1.6:31246');
        vm.loading = false
        vm.frameShow = true
      },1000)

    },
    closeFrame(){
      this.frameDom.style.width = '90%'
      this.frameDom.style.height = '80%'
      this.frameDom.style.transition='all .2s linear'
      this.frameShow = false
      this.frame.src = ''
      this.wrapper = ''
    },
    bigFrame(){
      if(this.frameDom.style.width=='100%'){
        this.frameDom.style.width = '90%'
        this.frameDom.style.height = '80%'
        this.frameDom.style.transition='all .2s linear'
        this.wrapper = 'wrapper'
      }else{
        this.frameDom.style.width = '100%'
        this.frameDom.style.height = '100%'
        this.frameDom.style.transition='all .2s linear'
        this.wrapper = ''
      }
      let data = {
        resize:true
      }
      window.frames[0].postMessage(data, '*');
    },
    smallFrame(){
      if(this.frameDom.style.width=='100%'){
        this.frameDom.style.width = '90%'
        this.frameDom.style.height = '80%'
        this.frameDom.style.transition='all .2s linear'
        this.wrapper = 'wrapper'
      }else{
        this.frameDom.style.width = '90%'
        this.frameDom.style.height = '80%'
        this.frameDom.style.transition='all .2s linear'
        this.frameShow = false
        this.frame.src = ''
        this.wrapper = ''
      }
    },
    /*获取权限*/

    getJurisdiction(){
      //GET_JURISDICTION
      let _this = this
      let header = {
        accessToken:  sessionStorage.getItem('accessToken'),
        projectId: sessionStorage.getItem('projectId')
      }
      let param = {}
      this.$store.dispatch('GET_JURISDICTION', { param, header }).then((res, req) => {
        console.log(res)
      }).catch((error) => {
        console.error(error)
      })
    },
    /*退出登陆*/
    logout(){
      let _this = this
      let header = {
        accessToken:sessionStorage.getItem('accessToken')
      }
      this.$store.dispatch('LOGOUT', { header }).then((res, req) => {
        this.$router.push('/login')
        _this.$notify({
          title: '提示信息',
          message: res.msg,
          type: res.code === 16000003 ? 'success' : 'error',
          duration: '2000'
        })
      }).catch((error) => {
        console.error(error)
      })
    }
  },
  created (){
    this.userName = this.$store.state.userName
    this.userType = this.$store.state.userType
    this.userPhone = this.$store.state.userPhone
    this.userEmail = this.$store.state.userEmail
    this.departmentName= this.$store.state.departmentName
    this.companyName = this.$store.state.companyName
    //this.getJurisdiction()
  },
  mounted () {
    this.frameDom = document.getElementById('frameBox')
    this.frame = document.getElementById('frame')
    this.removeKey()
  }
}
</script>
<style scoped lang="scss">
.downBox{
  text-align: center;
  color: #6A6A6A;
  .userLab{
    text-align: left;
    margin: 0 0 20px 35px;
  }
}
.downBoxImg{
  width: 100%;
  height: 150px;
  margin: 0 auto 20px;
  border-bottom: 1px solid #ccc;
  .circleImage{
    display: inline-block;
    width: 100px;
    height: 100px;
    border-radius: 50px;
    img{
      width: 99%;
      height: 99%;
      border-radius: 50%;
      margin-bottom: 10px;
    }
  }
}
.el-main{
  position: relative;
}
.home{
  height: 100%;
  background-image: url("../../assets/home_bg.jpg");
  background-repeat: no-repeat;
  background-size: 100% 100%;
  background-position: center center;
  .nav-bar-right {
    float: right;
  }
}
.head-img-box {
  color: #fff;
  height: 60px;
  line-height: 60px;
  .circle-bg {
    width: 25px;
    height: 25px;
    line-height: 1;
  }
  .circle-bg,
  img {
    display: inline-block;
    width: 24px;
    height: 24px;
    background-color: #a4ca68;
    vertical-align: middle;
    border-radius: 12px;
  }
}
.menu{
  position: absolute;
  top:0;
  right: 0;
  bottom: 0;
  left: 0;
  margin: auto;
  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  align-items: center;
  align-content: center;
  li{
    flex: 0 0 16.6%;
    margin-bottom: 20px;
    text-align: center;
    .menu-item{
      display: inline-block;
      padding: 20px;
      margin-bottom: 15px;
      width: 140px;
      height: 140px;
      background: rgba(49,49,49,0.24);
      box-shadow: 0 0 36px rgba(#999, .24) ;
      border-radius: 32px;
      img{
        display: inline-block;
        width: 100%;
      }
      +p{
        color: #fff;
        text-align: center;
        font-size: 24px;
      }
    }
  };
  li:hover .menu-item{
    background: rgba(46,46,46,0.5);
    box-shadow: 0 0 36px rgba(#bfd046, .9) ;
  }
}
.frameBox{
  background: #f5f5f5;
  width: 90%;
  height: 80%;
  position: absolute;
  top: 0;
  left: 0;
  right:0;
  bottom: 0;
  margin:auto;
  .frameTit{
    width: 100%;
    height: 5%;
    background: #bfd046;
    padding: .1% 0;
    position: relative;
    .iBox{
      height: 20px;
      position: absolute;
      top: 0;
      left: 0;
      right:0;
      bottom: 0;
      margin:auto;
      padding-right: 5px;
      i{
        color: white;
        font-size: 16px;
      }
      i:hover{
        color: #999;
      }
    }
  }
  .frame{
    width: 100%;
    height: 94.5%;
  }

}
</style>
